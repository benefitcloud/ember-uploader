// ==========================================================================
// Project:   Ember Uploader - v0.2.7
// Homepage:  https://github.com/benefitcloud/ember-uploader
// Copyright: Â©2014 Joshua Borton
// Licensed:  MIT
// ==========================================================================

(function(){var a=Ember.get,b=Ember.set;Ember.Uploader=Ember.Object.extend(Ember.Evented,{url:null,paramNamespace:null,paramName:"file",type:"POST",upload:function(c){var d=this.setupFormData(c);var e=a(this,"url");var f=a(this,"type");var g=this;b(this,"isUploading",true);return this.ajax(e,d,f).then(function(a){g.didUpload(a);return a})},setupFormData:function(a,b){var c=new FormData;for(var d in b){if(b.hasOwnProperty(d)){c.append(this.toNamespacedParam(d),b[d])}}c.append(this.toNamespacedParam(this.paramName),a);return c},toNamespacedParam:function(a){if(this.paramNamespace){return this.paramNamespace+"["+a+"]"}return a},didUpload:function(a){b(this,"isUploading",false);this.trigger("didUpload",a)},didProgress:function(a){a.percent=a.loaded/a.total*100;this.trigger("progress",a)},ajax:function(a,b,c){var d=this;var e={url:a,type:c||"POST",contentType:false,processData:false,xhr:function(){var a=Ember.$.ajaxSettings.xhr();a.upload.onprogress=function(a){d.didProgress(a)};return a},data:b};return this._ajax(e)},_ajax:function(a){return new Ember.RSVP.Promise(function(b,c){a.success=function(a){Ember.run(null,b,a)};a.error=function(a,b,d){Ember.run(null,c,a)};Ember.$.ajax(a)})}})})();(function(){var a=Ember.get,b=Ember.set;Ember.S3Uploader=Ember.Uploader.extend({url:"/sign",upload:function(a){var c=this;b(this,"isUploading",true);return this.sign(a).then(function(b){var d="http://"+b.bucket+".s3.amazonaws.com";var e=c.setupFormData(a,b);return c.ajax(d,e)}).then(function(a){c.didUpload(a);return a})},sign:function(b){var c={url:a(this,"url"),type:"GET",contentType:"json",data:{name:b.name,type:b.type,size:b.size}};return this._ajax(c)}})})();(function(){var a=Ember.set;Ember.FileField=Ember.TextField.extend({type:"file",attributeBindings:["multiple"],multiple:false,change:function(b){var c=b.target;if(!Ember.isEmpty(c.files)){a(this,"files",c.files)}}})})();